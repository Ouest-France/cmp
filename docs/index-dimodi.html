<!DOCTYPE html>
<html lang="fr">
<head>
<title>cmp sipa</title>
<meta charset="utf-8">
<meta name="robots" content="noindex">

<meta name="viewport" content="width=device-width">
    <link rel="stylesheet" media="all" href="oueststrap/oueststrap-of.min.css">
    <link rel="stylesheet" media="screen and (max-width: 979px)" href="oueststrap/oueststrap-of-small.min.css">
    <link rel="stylesheet" media="screen and (min-width: 980px)" href="oueststrap/oueststrap-of-medium.min.css">
    <link rel="stylesheet" media="screen and (min-width: 1280px)" href="oueststrap/oueststrap-of-large.min.css">

    <link rel="icon" href="oueststrap/favicon.ico" />

<script>
    window.gdprAppliesGlobally=true;
    (function(){function n(){if(!window.frames.__cmpLocator){if(document.body&&document.body.firstChild){var e=document.body;var t=document.createElement("iframe");t.style.display="none";t.name="__cmpLocator";t.title="cmpLocator";e.insertBefore(t,e.firstChild)}else{setTimeout(n,5)}}}function e(e,t,n){if(typeof n!=="function"){return}
    if(!window.__cmpBuffer){window.__cmpBuffer=[]}if(e==="ping"){n({gdprAppliesGlobally:window.gdprAppliesGlobally,cmpLoaded:false},true)}else{window.__cmpBuffer.push({command:e,parameter:t,callback:n})}}e.stub=true;function t(r){if(!window.__cmp||window.__cmp.stub!==true){return}if(!r.data){return}var a=typeof r.data==="string";var e;try{e=a?JSON.parse(r.data):r.data}catch(t){return}if(e.__cmpCall){var o=e.__cmpCall;window.__cmp(o.command,o.parameter,function(e,t){var n={__cmpReturn:{returnValue:e,success:t,callId:o.callId}};r.source.postMessage(a?JSON.stringify(n):n,"*")})}}if(typeof window.__cmp!=="function"){window.__cmp=e;if(window.addEventListener){window.addEventListener("message",t,false)}else{window.attachEvent("onmessage",t)}}n()})();(function(e){var t=document.createElement("script");t.id="spcloader";t.type="text/javascript";t.async=true;t.src="https://sdk.privacy-center.org/"+e+"/loader.js?target="+document.location.hostname;t.charset="utf-8";var n=document.getElementsByTagName("script")[0];
    n.parentNode.insertBefore(t,n)})("aeca3085-d50f-45e1-8236-457f11ef78b8");

    window.didomiConfig = {
        preferences: {
            content: {
                agreeToAll: {
                    fr: 'Accepter toutes les finalités'
                }
            }
        }
    };

    window.didomiOnReady = window.didomiOnReady || [];
    window.didomiOnReady.push(function (Didomi) {
        if ('undefined' === typeof window.tc_vars) {
            window.tc_vars = {};
        };
        window.tc_vars["didomiGDPRApplies"] = window.didomiState.didomiGDPRApplies;
        window.tc_vars["didomiIABConsent"] = window.didomiState.didomiIABConsent;
        window.tc_vars["didomiVendorsConsent"] = window.didomiState.didomiVendorsConsent;
        window.tc_vars["didomiVendorsConsentUnknown"] = window.didomiState.didomiVendorsConsentUnknown;
        window.tc_vars["didomiVendorsConsentDenied"] = window.didomiState.didomiVendorsConsentDenied;
        window.tc_vars["didomiPurposesConsent"] = window.didomiState.didomiPurposesConsent;
        window.tc_vars["didomiPurposesConsentUnknown"] = window.didomiState.didomiPurposesConsentUnknown;
        window.tc_vars["didomiPurposesConsentDenied"] = window.didomiState.didomiPurposesConsentDenied;
        window.tc_vars["didomiExperimentId"] = window.didomiState.didomiExperimentId;
        window.tc_vars["didomiExperimentUserGroup"] = window.didomiState.didomiExperimentUserGroup;

        if(Didomi.notice.isVisible()) {
            window.addEventListener('scroll', scrollListener);
        }
    });

    function scrollListener(e) {
        var windowHeight = window.innerHeight ||
        document.documentElement.clientHeight ||
        document.body.clientHeight || 0;
        var docHeight = Math.max(
            document.body.scrollHeight || 0,
            document.documentElement.scrollHeight || 0,
            document.body.offsetHeight || 0,
            document.documentElement.offsetHeight || 0,
            document.body.clientHeight || 0,
            document.documentElement.clientHeight || 0,
            );
        var yScroll = window.pageYOffset ||
        document.body.scrollTop ||
        document.documentElement.scrollTop || 0;
        var scrollPercent = (yScroll / (docHeight - windowHeight)) * 100;

        if (scrollPercent >= 10) {
            Didomi.setUserAgreeToAll();
            window.removeEventListener("scroll", scrollListener);
        }
    }
</script>

</head>
<body>

<a href="index-dimodi.html">dimodi</a>
<a href="index-quantcast.html">quantcast</a>
<a href="index-appconsent.html">appconsent</a>
<a href="index-trustcommander.html">trustcommander</a>
<a href="index-cookielaw.html">cookielaw</a>
<a href="index-cookiebot.html">cookiebot</a>




    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKNG2FZ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="container-of">
        <h1 class="titre-rubrique">SIPA CMP - Documentation</h1>
        <p class="margin-large">CMP du groupe SIPA certifiée conforme par l’IAB</p>
        <p class="margin-large">Pour toute question, nous contacter à l'adresse suivante : <a href="mailto:contact-tracking@ouest-france.fr">contact-tracking@ouest-france.fr</a> </p>


        <p class="h2 titre-rubrique" id="p1">1/ Supprimer une éventuelle CMP qui serait déjà présente</p>

        <p class="h2 titre-rubrique" id="p2">2/ Insérer le snippet suivant dans la balise <code>&lt;head></code> de toutes les pages : </p>

        <div class="form">
            <textarea id="snippet" style="height: 200px;"><script>!function(e,a,c,n,t){if(a.__cmp=function(){var e=[],n=function(a,c,t){"ping"===a?t&&t({gdprAppliesGlobally:!!(n&&n.config&&n.config.storeConsentGlobally),cmpLoaded:!1}):e.push({command:a,parameter:c,callback:t})};return n.commandQueue=e,n.config=a.__cmp&&a.__cmp.config?a.__cmp.config:{},n.receiveMessage=function(a){var c=a&&a.data&&a.data.__cmpCall;c&&e.push({command:c.command,parameter:c.parameter,callback:function(e,n){var t={__cmpReturn:{returnValue:e,success:n,callId:c.callId}};a.source.postMessage(t,"*")}})},(a.attachEvent||a.addEventListener)("message",function(e){a.__cmp.receiveMessage(e)},!1),function e(){if(!a.frames.__cmpLocator)if(c.body){var n=c.createElement("iframe");n.style.display="none",n.name="__cmpLocator",c.body.appendChild(n)}else setTimeout(e,50)}(),n}(),!c.getElementById(t)){var o=c.createElement("script"),s=c.getElementsByTagName("script")[0];o.async=1,o.src="https://sipaof.mgr.consensu.org/sipacmp/js/sipa-cmp.min.js",o.type="text/javascript",o.id=t,s.parentNode.insertBefore(o,s)}}(0,window,document,0,"sipacmp_loader");</script></textarea>
            <button class="btn btn-n1" onclick="document.getElementById('snippet').select(); document.execCommand('copy');confirm('code copié!');">Copier le code dans le presse papier</button>
        </div>

        <p class="h2 titre-rubrique" id="p3">3/ Insérer le code pour réafficher le bandeau</p>

        <div class="form">
            <p>La CNIL impose de placer un lien de ce type dans le footer.</p>
            <p>Si la fonction _cmp.show() est dans la page, alors le bandeau se réaffichera. Voici un exemple avec le bouton "Réafficher le bandeau" :</p>
            <textarea>__cmp.show();</textarea>
            <button class="btn btn-n2" onclick="__cmp.show();">Réafficher le bandeau</button>
        </div>

        <p class="h2 titre-rubrique"  id="p4">4/ Configurer les différentes options (optionnel)</p>

        <p class="margin-small">Il suffit de mettre les balises suivantes juste <strong>après</strong> l'appel "stub"</p>
        <div class="form" style="padding-left: 30px;">
            <ul>
                <li>
                    <h4>Pourcentage de scroll</h4>
                    <code>// consent dès 1pixel scrollé</code>
                    <textarea>&lt;script>window.__cmp.config.scrollPercent = 0; &lt;/script></textarea>
                    <code>// consent dès 20% scrollé</code>
                    <textarea>&lt;script>window.__cmp.config.scrollPercent = .20; &lt;/script></textarea>
                </li>
                <li>
                    <h4>Conteneur de scroll</h4>
                    <p>Par défaut, le scroll est écouté sur <code>window</code>. Si un autre conteneur doit être utilisé, il est possible de l'indiquer comme ceci&nbsp;:</p>
                    <code>// au chargement de la page</code>
                    <textarea>&lt;script>window.__cmp.config.scrollContainer = document.getElementById("mon-conteneur"); &lt;/script></textarea>
                    <code>// au cours du cycle de vie de l'application (SPA)</code>
                    <textarea>&lt;script>window.__cmp("setScrollContainer", document.getElementById("mon-conteneur")); &lt;/script></textarea>
                </li>
                <li>
                    <h4>Texte d’explication</h4>
                    <code>// html autorisé. <br/>Exemple en <strong>Template Strings</strong></code>
                    <textarea style="height: 200px;">&lt;script>window.__cmp.config.text = 'Texte personnalisé <a href="https://www.domain.com/lien-1/" target="_blank" data-trkcmp="lien 1">lien 1</a> et <a href="https://www.domain.com/lien-2/" target="_blank" data-trkcmp="lien 2">lien 2</a>, fin du texte.';&lt;/script></textarea>
                </li>
            </ul>
        </div>

        <p class="h2 titre-rubrique" id="p5">5/ Isoler les pages spécifiques</p>

        <p>Ce script doit être inclus sur les pages où la navigation (scroll, clic sur un lien, rafraîchissement...) ne doit pas être considérée comme une acceptation (mentions légales, CGU).</p>
        <div class="form">
            <textarea>&lt;script>window.sipacmp_gcda = true; // _global_consent_doesnt_apply&lt;/script></textarea>
        </div>

        <p class="h2 titre-rubrique" id="p6">6/ Cookies et local storage</p>

        <p>La CMP pose un cookie 1st party "sipacmp_consent" au niveau du top level domain. Il contient une valeur binaire correspondant à l'acceptation des différentes familles : </p>
        <ul>
          <li>33 : toutes les familles refusées</li>
          <li>41 : Web analytics uniquement</li>
          <li>35 : Social uniquement</li>
          <li>37 : Publicité uniquement</li>
          <li>49 : Contenus éditoriaux uniquement</li>
          <li>43 : Webanalytics + Social</li>
          <li>53 : Publicité + Contenus éditoriaux</li>
          <li>45 : Web analytics + Publicité</li>
          <li>51 : Social + contenus éditoriaux</li>
          <li>57 : Web analytics + contenus éditoriaux</li>
          <li>39 : Social + Publicité</li>
          <li>47 : Web analytics + Social + Publicité</li>
          <li>55 : Social + Publicité + Contenus éditoriaux</li>
          <li>59 : Web analytics + Social + Contenus éditoriaux</li>
          <li>61 : Web analytics + Publicité + Contenus éditoriaux</li>
          <li>63 : toutes les familles acceptées</li>
        </ul>
        <br>
        <p>La CMP pose également 4 local storage avant consentement :</p>
        <ul>
          <li>sipacmp-consent-data : contenu du consentement encodé</li>
          <li>sipacmp-consent-token : booléen représentant l'acceptation / refus</li>
          <li>sipacmp-vendorlist : liste des éditeurs présent dans le framework IAB</li>
          <li>sipacmp-vendorlist-update : timestamp représentant la dernière mise à jour de la vendor list (cf. plus haut)</li>
        </ul><br>
        <p>Puis 2 après consentement :</p>
        <ul>
          <li>sipacmp-consent : JSON contenant le consentement par familles (ex : {"functionning":true, "social":true, "advertising":true, "analytics":true, "editorial":true, "family":true})</li>
          <li>sipacmp-consent-uuid : identifiant unique permettant de récolter des données anonymes sur le consentement</li>
        </ul>

        <p class="h2 titre-rubrique" id="p7">7/ Encapsulation de tags présents en dur dans le code source</p>

        <p>Si vous avez des tags présents en dur dans votre site à même de poser des cookies (analytics, publicité...), vous pouvez les encapsuler en utilisant les familles de cookies ci-dessus. Voici un exemple si vous voulez insérer un tag Google Analytics via Gtag :<br>

        <div class="form">
          <textarea style="height: 250px">&lt;script async src="https://www.googletagmanager.com/gtag/js?id=UA-12345678-1">&lt;/script>
&lt;script>
    __cmp('getUserConsent', {}, function(e){
        if(e.consent && e.consent.analytics){
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-12345678-1');
        }
    })();
&lt;/script></textarea>
        </div>



        </p>

        <p class="h2 titre-rubrique" id="p8">8/ Divers</p>


        <p class="h3 titre-rubrique">Récupérer le consentement reçu (attente validation) à la pub: </p>
        <p>L'appel à la fonction getUserConsent créer une promesse qui sera éxécutera la fonction callback lorsque l'utilisateur aura indiqué son choix. (que se soit un consentement ou un refus).</p>
        <p>Ca permet d'avoir par exemple un partenaire qui s'affiche dès la 1ere page visitée lorsque le bandeau sera validé.</p>
        <p>La fonction recoit en parametre un objet retour qui contient la propriété consent. Cette propriété est un objet qui contient un booléen pour chaque famille.</p>
        <p>Voici quelques exemple dans une fonction callback qui vous servent à intégrer un partenaire:</p>
        <div class="form">
            <textarea id="snippet4" style="height: 250px;">&lt;script>__cmp('getUserConsent', {}, function(e){
    if(e.consent){
        console.log('bandeau vu et pub acceptée ou refusée, mais mon partenaire est compatible IAB et gère le cookieless')
    }
    if(e.consent && e.consent.advertising){
        console.log('bandeau vu et pub acceptée')
    } else {
        console.log('bandeau vu et pub refusée')
    }
});&lt;/script></textarea>
            <button class="btn btn-n2 btn-petit" onclick="document.getElementById('snippet4').select(); document.execCommand('copy');confirm('code copié!');">Copier le code dans le presse papier</button>
        </div>


        <p class="h3 titre-rubrique">Nettoyer toutes les infos stockées: </p>
        <div class="form">
            <textarea>localStorage.clear();var top = location.hostname.split('.').reverse();top = top[1].length > 2 ? "." + top[1] + "." + top[0] : location.hostname;document.cookie = 'sipacmp_consent=;expires=Thu, 01 Jan 1970 00:00:00 GMT;';</textarea>
            <button class="btn btn-n2" onclick="localStorage.clear();var top = location.hostname.split('.').reverse();top = top[1].length > 2 ? '.' + top[1] + '.' + top[0] : location.hostname;document.cookie = 'sipacmp_consent=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain=' + top + ';path=/;'">Nettoyer</button>
        </div>



        <p class="h3 titre-rubrique">Url de la liste globale téléchargée toutes les semaines: </p>
        <div class="form">
            <textarea>https://vendorlist.consensu.org/vendorlist.json</textarea>
        </div>
    </div>
    <script>
        var cmpl = setInterval(function(){
            __cmp('ping', {}, function(e){
                if(e.cmpLoaded) {
                    clearInterval(cmpl)
                    performance.measure("cmp_loaded");
                }
            })
        }, 25)

    </script>
    <script>__cmp('getConsentData', {}, function(e, s){
console.log(e, s);
        performance.measure("cmp_ready");


        var timings = function(){

            var t = window.performance.timing,
                interactive = t.domInteractive - t.domLoading,
                dcl = t.domContentLoadedEventStart - t.domLoading,
                complete = t.domComplete - t.domLoading;

            console.log("interactive", interactive)
            console.log("dom_content_loaded", dcl)
            console.log("complete", complete)

            performance.getEntriesByType("measure").forEach(m => {
                console.log(m.name, m.duration.toFixed(2));
            })

        }

        if( document.readyState === 'complete' ) {
            timings()
        } else {
            document.addEventListener('readystatechange', function() {
                if( document.readyState === 'complete' ) {
                    timings()
                }
            });
        }

    });
    </script>

</body>
</html>
