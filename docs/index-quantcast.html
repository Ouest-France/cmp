<!DOCTYPE html>
<html lang="fr">
<head>
<title>cmp sipa</title>
<meta charset="utf-8">
<meta name="robots" content="noindex">

<meta name="viewport" content="width=device-width">
    <link rel="stylesheet" media="all" href="oueststrap/oueststrap-of.min.css">
    <link rel="stylesheet" media="screen and (max-width: 979px)" href="oueststrap/oueststrap-of-small.min.css">
    <link rel="stylesheet" media="screen and (min-width: 980px)" href="oueststrap/oueststrap-of-medium.min.css">
    <link rel="stylesheet" media="screen and (min-width: 1280px)" href="oueststrap/oueststrap-of-large.min.css">

    <link rel="icon" href="oueststrap/favicon.ico" />

<!-- Quantcast Choice. Consent Manager Tag -->
<script type="text/javascript" async=true>
    var elem = document.createElement('script');
    elem.src = 'https://quantcast.mgr.consensu.org/cmp.js';
    elem.async = true;
    elem.type = "text/javascript";
    var scpt = document.getElementsByTagName('script')[0];
    scpt.parentNode.insertBefore(elem, scpt);
    (function() {
    var gdprAppliesGlobally = true;
    function addFrame() {
        if (!window.frames['__cmpLocator']) {
        if (document.body) {
            var body = document.body,
                iframe = document.createElement('iframe');
            iframe.style = 'display:none';
            iframe.name = '__cmpLocator';
            body.appendChild(iframe);
        } else {
            // In the case where this stub is located in the head,
            // this allows us to inject the iframe more quickly than
            // relying on DOMContentLoaded or other events.
            setTimeout(addFrame, 5);
        }
        }
    }
    addFrame();
    function cmpMsgHandler(event) {
        var msgIsString = typeof event.data === "string";
        var json;
        if(msgIsString) {
        json = event.data.indexOf("__cmpCall") != -1 ? JSON.parse(event.data) : {};
        } else {
        json = event.data;
        }
        if (json.__cmpCall) {
        var i = json.__cmpCall;
        window.__cmp(i.command, i.parameter, function(retValue, success) {
            var returnMsg = {"__cmpReturn": {
            "returnValue": retValue,
            "success": success,
            "callId": i.callId
            }};
            event.source.postMessage(msgIsString ?
            JSON.stringify(returnMsg) : returnMsg, '*');
        });
        }
    }
    window.__cmp = function (c) {
        var b = arguments;
        if (!b.length) {
        return __cmp.a;
        }
        else if (b[0] === 'ping') {
        b[2]({"gdprAppliesGlobally": gdprAppliesGlobally,
            "cmpLoaded": false}, true);
        } else if (c == '__cmp')
        return false;
        else {
        if (typeof __cmp.a === 'undefined') {
            __cmp.a = [];
        }
        __cmp.a.push([].slice.apply(b));
        }
    }
    window.__cmp.gdprAppliesGlobally = gdprAppliesGlobally;
    window.__cmp.msgHandler = cmpMsgHandler;
    if (window.addEventListener) {
        window.addEventListener('message', cmpMsgHandler, false);
    }
    else {
        window.attachEvent('onmessage', cmpMsgHandler);
    }
    })();
    window.__cmp('init', {
            'Language': 'fr',
        'Initial Screen Title Text': 'Le respect de votre vie privée est notre priorité',
        'Initial Screen Reject Button Text': 'JE N’ACCEPTE PAS',
        'Initial Screen Accept Button Text': 'J&#039;ACCEPTE',
        'Initial Screen Purpose Link Text': 'Afficher les objectifs',
        'Purpose Screen Title Text': 'Le respect de votre vie privée est notre priorité',
        'Purpose Screen Body Text': 'Vous pouvez définir ci-dessous vos préférences de consentement et déterminer la manière dont vous souhaitez que vos données soient utilisées en fonction des objectifs mentionnés. Vous pouvez définir vos préférences pour notre société, indépendamment de celles de nos partenaires tiers. Chaque objectif est décrit afin que vous sachiez comment nos partenaires et nous-mêmes exploitons vos données.',
        'Purpose Screen Vendor Link Text': 'Consulter les fournisseurs',
        'Purpose Screen Cancel Button Text': 'Annuler',
        'Purpose Screen Save and Exit Button Text': 'Enregistrer et quitter',
        'Vendor Screen Title Text': 'Le respect de votre vie privée est notre priorité',
        'Vendor Screen Body Text': 'Vous pouvez définir ci-dessous vos préférences de consentement pour les partenaires tiers avec lesquels nous collaborons. Développez chaque élément de la liste des sociétés afin de découvrir l’objectif de ce traitement de données et de préciser votre choix. Dans certains cas, les sociétés peuvent exploiter vos données sans demander votre consentement, sur la base de leurs intérêts légitimes. Vous pouvez cliquer sur les liens relatifs à leur politique de confidentialité afin d’obtenir plus d’informations et de vous opposer à un tel traitement si vous le désirez.',
        'Vendor Screen Accept All Button Text': 'TOUT ACCEPTER',
        'Vendor Screen Reject All Button Text': 'TOUT REFUSER',
        'Vendor Screen Purposes Link Text': 'Retour aux objectifs',
        'Vendor Screen Cancel Button Text': 'Annuler',
        'Vendor Screen Save and Exit Button Text': 'Enregistrer et quitter',
        'Initial Screen Body Text': 'Nos partenaires et nous-mêmes exploitons différentes technologies, telles que celle des cookies, et traitons vos données à caractère personnel, telles que les adresses IP et les identifiants de cookie, afin de personnaliser les publicités et les contenus en fonction de vos centres d’intérêt, d’évaluer la performance de ces publicités et contenus, et de recueillir des informations sur les publics qui les ont visionnés. Cliquez ci-dessous si vous consentez à l’utilisation de cette technologie et au traitement de vos données à caractère personnel en vue de ces objectifs. Vous pouvez changer d’avis et modifier votre consentement à tout moment en revenant sur ce site.',
        'Initial Screen Body Text Option': 1,
        'Publisher Name': 'test',
        'Display UI': 'always',
        'Min Days Between UI Displays': null,
        'Publisher Purpose IDs': [1,2,3,4,5],
        'Consent Scope': 'service',
        'UI Layout': 'banner',
    });
</script>
<!-- End Quantcast Choice. Consent Manager Tag -->
    <style>
        .qc-cmp-button.qc-cmp-secondary-button {
          border-color: #eee !important;
          background-color: #eee !important;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKNG2FZ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="container-of">
        <h1 class="titre-rubrique">SIPA CMP - Documentation</h1>
        <p class="margin-large">CMP du groupe SIPA certifiée conforme par l’IAB</p>
        <p class="margin-large">Pour toute question, nous contacter à l'adresse suivante : <a href="mailto:contact-tracking@ouest-france.fr">contact-tracking@ouest-france.fr</a> </p>


        <p class="h2 titre-rubrique" id="p1">1/ Supprimer une éventuelle CMP qui serait déjà présente</p>

        <p class="h2 titre-rubrique" id="p2">2/ Insérer le snippet suivant dans la balise <code>&lt;head></code> de toutes les pages : </p>

        <div class="form">
            <textarea id="snippet" style="height: 200px;"><script>!function(e,a,c,n,t){if(a.__cmp=function(){var e=[],n=function(a,c,t){"ping"===a?t&&t({gdprAppliesGlobally:!!(n&&n.config&&n.config.storeConsentGlobally),cmpLoaded:!1}):e.push({command:a,parameter:c,callback:t})};return n.commandQueue=e,n.config=a.__cmp&&a.__cmp.config?a.__cmp.config:{},n.receiveMessage=function(a){var c=a&&a.data&&a.data.__cmpCall;c&&e.push({command:c.command,parameter:c.parameter,callback:function(e,n){var t={__cmpReturn:{returnValue:e,success:n,callId:c.callId}};a.source.postMessage(t,"*")}})},(a.attachEvent||a.addEventListener)("message",function(e){a.__cmp.receiveMessage(e)},!1),function e(){if(!a.frames.__cmpLocator)if(c.body){var n=c.createElement("iframe");n.style.display="none",n.name="__cmpLocator",c.body.appendChild(n)}else setTimeout(e,50)}(),n}(),!c.getElementById(t)){var o=c.createElement("script"),s=c.getElementsByTagName("script")[0];o.async=1,o.src="https://sipaof.mgr.consensu.org/sipacmp/js/sipa-cmp.min.js",o.type="text/javascript",o.id=t,s.parentNode.insertBefore(o,s)}}(0,window,document,0,"sipacmp_loader");</script></textarea>
            <button class="btn btn-n1" onclick="document.getElementById('snippet').select(); document.execCommand('copy');confirm('code copié!');">Copier le code dans le presse papier</button>
        </div>

        <p class="h2 titre-rubrique" id="p3">3/ Insérer le code pour réafficher le bandeau</p>

        <div class="form">
            <p>La CNIL impose de placer un lien de ce type dans le footer.</p>
            <p>Si la fonction _cmp.show() est dans la page, alors le bandeau se réaffichera. Voici un exemple avec le bouton "Réafficher le bandeau" :</p>
            <textarea>__cmp.show();</textarea>
            <button class="btn btn-n2" onclick="__cmp.show();">Réafficher le bandeau</button>
        </div>

        <p class="h2 titre-rubrique"  id="p4">4/ Configurer les différentes options (optionnel)</p>

        <p class="margin-small">Il suffit de mettre les balises suivantes juste <strong>après</strong> l'appel "stub"</p>
        <div class="form" style="padding-left: 30px;">
            <ul>
                <li>
                    <h4>Pourcentage de scroll</h4>
                    <code>// consent dès 1pixel scrollé</code>
                    <textarea>&lt;script>window.__cmp.config.scrollPercent = 0; &lt;/script></textarea>
                    <code>// consent dès 20% scrollé</code>
                    <textarea>&lt;script>window.__cmp.config.scrollPercent = .20; &lt;/script></textarea>
                </li>
                <li>
                    <h4>Conteneur de scroll</h4>
                    <p>Par défaut, le scroll est écouté sur <code>window</code>. Si un autre conteneur doit être utilisé, il est possible de l'indiquer comme ceci&nbsp;:</p>
                    <code>// au chargement de la page</code>
                    <textarea>&lt;script>window.__cmp.config.scrollContainer = document.getElementById("mon-conteneur"); &lt;/script></textarea>
                    <code>// au cours du cycle de vie de l'application (SPA)</code>
                    <textarea>&lt;script>window.__cmp("setScrollContainer", document.getElementById("mon-conteneur")); &lt;/script></textarea>
                </li>
                <li>
                    <h4>Texte d’explication</h4>
                    <code>// html autorisé. <br/>Exemple en <strong>Template Strings</strong></code>
                    <textarea style="height: 200px;">&lt;script>window.__cmp.config.text = 'Texte personnalisé <a href="https://www.domain.com/lien-1/" target="_blank" data-trkcmp="lien 1">lien 1</a> et <a href="https://www.domain.com/lien-2/" target="_blank" data-trkcmp="lien 2">lien 2</a>, fin du texte.';&lt;/script></textarea>
                </li>
            </ul>
        </div>

        <p class="h2 titre-rubrique" id="p5">5/ Isoler les pages spécifiques</p>

        <p>Ce script doit être inclus sur les pages où la navigation (scroll, clic sur un lien, rafraîchissement...) ne doit pas être considérée comme une acceptation (mentions légales, CGU).</p>
        <div class="form">
            <textarea>&lt;script>window.sipacmp_gcda = true; // _global_consent_doesnt_apply&lt;/script></textarea>
        </div>

        <p class="h2 titre-rubrique" id="p6">6/ Cookies et local storage</p>

        <p>La CMP pose un cookie 1st party "sipacmp_consent" au niveau du top level domain. Il contient une valeur binaire correspondant à l'acceptation des différentes familles : </p>
        <ul>
          <li>33 : toutes les familles refusées</li>
          <li>41 : Web analytics uniquement</li>
          <li>35 : Social uniquement</li>
          <li>37 : Publicité uniquement</li>
          <li>49 : Contenus éditoriaux uniquement</li>
          <li>43 : Webanalytics + Social</li>
          <li>53 : Publicité + Contenus éditoriaux</li>
          <li>45 : Web analytics + Publicité</li>
          <li>51 : Social + contenus éditoriaux</li>
          <li>57 : Web analytics + contenus éditoriaux</li>
          <li>39 : Social + Publicité</li>
          <li>47 : Web analytics + Social + Publicité</li>
          <li>55 : Social + Publicité + Contenus éditoriaux</li>
          <li>59 : Web analytics + Social + Contenus éditoriaux</li>
          <li>61 : Web analytics + Publicité + Contenus éditoriaux</li>
          <li>63 : toutes les familles acceptées</li>
        </ul>
        <br>
        <p>La CMP pose également 4 local storage avant consentement :</p>
        <ul>
          <li>sipacmp-consent-data : contenu du consentement encodé</li>
          <li>sipacmp-consent-token : booléen représentant l'acceptation / refus</li>
          <li>sipacmp-vendorlist : liste des éditeurs présent dans le framework IAB</li>
          <li>sipacmp-vendorlist-update : timestamp représentant la dernière mise à jour de la vendor list (cf. plus haut)</li>
        </ul><br>
        <p>Puis 2 après consentement :</p>
        <ul>
          <li>sipacmp-consent : JSON contenant le consentement par familles (ex : {"functionning":true, "social":true, "advertising":true, "analytics":true, "editorial":true, "family":true})</li>
          <li>sipacmp-consent-uuid : identifiant unique permettant de récolter des données anonymes sur le consentement</li>
        </ul>

        <p class="h2 titre-rubrique" id="p7">7/ Encapsulation de tags présents en dur dans le code source</p>

        <p>Si vous avez des tags présents en dur dans votre site à même de poser des cookies (analytics, publicité...), vous pouvez les encapsuler en utilisant les familles de cookies ci-dessus. Voici un exemple si vous voulez insérer un tag Google Analytics via Gtag :<br>

        <div class="form">
          <textarea style="height: 250px">&lt;script async src="https://www.googletagmanager.com/gtag/js?id=UA-12345678-1">&lt;/script>
&lt;script>
    __cmp('getUserConsent', {}, function(e){
        if(e.consent && e.consent.analytics){
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-12345678-1');
        }
    })();
&lt;/script></textarea>
        </div>



        </p>

        <p class="h2 titre-rubrique" id="p8">8/ Divers</p>


        <p class="h3 titre-rubrique">Récupérer le consentement reçu (attente validation) à la pub: </p>
        <p>L'appel à la fonction getUserConsent créer une promesse qui sera éxécutera la fonction callback lorsque l'utilisateur aura indiqué son choix. (que se soit un consentement ou un refus).</p>
        <p>Ca permet d'avoir par exemple un partenaire qui s'affiche dès la 1ere page visitée lorsque le bandeau sera validé.</p>
        <p>La fonction recoit en parametre un objet retour qui contient la propriété consent. Cette propriété est un objet qui contient un booléen pour chaque famille.</p>
        <p>Voici quelques exemple dans une fonction callback qui vous servent à intégrer un partenaire:</p>
        <div class="form">
            <textarea id="snippet4" style="height: 250px;">&lt;script>__cmp('getUserConsent', {}, function(e){
    if(e.consent){
        console.log('bandeau vu et pub acceptée ou refusée, mais mon partenaire est compatible IAB et gère le cookieless')
    }
    if(e.consent && e.consent.advertising){
        console.log('bandeau vu et pub acceptée')
    } else {
        console.log('bandeau vu et pub refusée')
    }
});&lt;/script></textarea>
            <button class="btn btn-n2 btn-petit" onclick="document.getElementById('snippet4').select(); document.execCommand('copy');confirm('code copié!');">Copier le code dans le presse papier</button>
        </div>


        <p class="h3 titre-rubrique">Nettoyer toutes les infos stockées: </p>
        <div class="form">
            <textarea>localStorage.clear();var top = location.hostname.split('.').reverse();top = top[1].length > 2 ? "." + top[1] + "." + top[0] : location.hostname;document.cookie = 'sipacmp_consent=;expires=Thu, 01 Jan 1970 00:00:00 GMT;';</textarea>
            <button class="btn btn-n2" onclick="localStorage.clear();var top = location.hostname.split('.').reverse();top = top[1].length > 2 ? '.' + top[1] + '.' + top[0] : location.hostname;document.cookie = 'sipacmp_consent=;expires=Thu, 01 Jan 1970 00:00:00 GMT;domain=' + top + ';path=/;'">Nettoyer</button>
        </div>



        <p class="h3 titre-rubrique">Url de la liste globale téléchargée toutes les semaines: </p>
        <div class="form">
            <textarea>https://vendorlist.consensu.org/vendorlist.json</textarea>
        </div>
    </div>
    <script>
        var cmpl = setInterval(function(){
            __cmp('ping', {}, function(e){
                if(e.cmpLoaded) {
                    clearInterval(cmpl)
                    performance.measure("cmp_loaded");
                }
            })
        }, 25)

    </script>
    <script>__cmp('getConsentData', {}, function(e, s){
console.log(e, s);
        performance.measure("cmp_ready");


        var timings = function(){

            var t = window.performance.timing,
                interactive = t.domInteractive - t.domLoading,
                dcl = t.domContentLoadedEventStart - t.domLoading,
                complete = t.domComplete - t.domLoading;

            console.log("interactive", interactive)
            console.log("dom_content_loaded", dcl)
            console.log("complete", complete)

            performance.getEntriesByType("measure").forEach(m => {
                console.log(m.name, m.duration.toFixed(2));
            })

        }

        if( document.readyState === 'complete' ) {
            timings()
        } else {
            document.addEventListener('readystatechange', function() {
                if( document.readyState === 'complete' ) {
                    timings()
                }
            });
        }

    });
    </script>

</body>
</html>
